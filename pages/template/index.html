<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>$title$</title>
  <link rel="stylesheet" href="stylesheet.css">
</head>
<body class="theme-tsuki">
  <div class="layout">
    <nav class="sidebar">
      <a class="home-link" href="../index.html">home</a>
      <button class="theme-toggle" onclick="toggleTheme()">ğŸŒ™/â˜€ï¸</button>   
      <div class="toc">
        $toc$
      </div>
    </nav>
    <main class="main-content">
      <div class="home-top">
        <a href="index.html">home</a>
        <button class="theme-toggle mobile-only" onclick="toggleTheme()">ğŸŒ™/â˜€ï¸</button>
      </div>
      <div id="content-wrapper">$body$</div>
      <div class="home-bottom"><a href="index.html">home</a></div>
    </main>
  </div>

  <script>
    // ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰æ©Ÿèƒ½
    function toggleTheme() {
      const body = document.body;
      const isDark = body.classList.contains('theme-dark');
      
      if (isDark) {
        body.classList.remove('theme-dark');
        body.classList.add('theme-tsuki');
      } else {
        body.classList.remove('theme-tsuki');
        body.classList.add('theme-dark');
      }
      
      // è¨­å®šã‚’ä¿å­˜
      const currentTheme = body.classList.contains('theme-dark') ? 'dark' : 'tsuki';
      document.cookie = `theme=${currentTheme}; path=/; max-age=31536000`; // 1å¹´é–“ä¿å­˜
    }
    
    // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«ãƒ†ãƒ¼ãƒã‚’å¾©å…ƒ
    function loadTheme() {
      const cookies = document.cookie.split(';');
      let theme = 'tsuki'; // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ
      
      for (let cookie of cookies) {
        const [name, value] = cookie.trim().split('=');
        if (name === 'theme') {
          theme = value;
          break;
        }
      }
      
      const body = document.body;
      body.classList.remove('theme-tsuki', 'theme-dark');
      body.classList.add(`theme-${theme}`);
    }

    document.addEventListener('DOMContentLoaded', function() {
      // ãƒ†ãƒ¼ãƒã‚’å…ˆã«èª­ã¿è¾¼ã¿
      loadTheme();
      
      const contentWrapper = document.getElementById('content-wrapper');
      const content = contentWrapper.innerHTML;
      
      // h2ã¨h3ã§åˆ†å‰²ã™ã‚‹ãŸã‚ã®æ­£è¦è¡¨ç¾
      const sectionRegex = /(<h[23][^>]*>.*?<\/h[23]>)/gi;
      
      // ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’h2/h3ã§åˆ†å‰²
      const parts = content.split(sectionRegex);
      let newHTML = '';
      let currentSection = '';
      let inSection = false;
      
      for (let i = 0; i < parts.length; i++) {
        const part = parts[i];
        
        // h2ã¾ãŸã¯h3ã®è¦‹å‡ºã—ã‹ãƒã‚§ãƒƒã‚¯
        if (part.match(/^<h[23]/i)) {
          // å‰ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’é–‰ã˜ã‚‹
          if (inSection && currentSection.trim()) {
            newHTML += '<div class="container-section">' + currentSection + '</div>';
          }
          // æ–°ã—ã„ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’é–‹å§‹
          currentSection = part;
          inSection = true;
        } else if (part.trim()) {
          // é€šå¸¸ã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„
          if (inSection) {
            currentSection += part;
          } else {
            // æœ€åˆã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆè¦‹å‡ºã—ãªã—ï¼‰
            if (!newHTML && part.trim()) {
              newHTML += '<div class="container-section">' + part + '</div>';
            }
          }
        }
      }
      
      // æœ€å¾Œã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’é–‰ã˜ã‚‹
      if (inSection && currentSection.trim()) {
        newHTML += '<div class="container-section">' + currentSection + '</div>';
      }
      
      // çµæœãŒç©ºã®å ´åˆã¯å…ƒã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’1ã¤ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã¨ã—ã¦è¡¨ç¤º
      if (!newHTML.trim()) {
        newHTML = '<div class="container-section">' + content + '</div>';
      }
      
      contentWrapper.innerHTML = newHTML;
    });
  </script>
</body>
</html>